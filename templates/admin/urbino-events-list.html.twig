{% extends 'admin/base.html.twig' %}

{% block body %}

    <div class="gg-h1">Eventi Urbino</div>

    <div style="margin-bottom: 20px;">
        <a class="gg-btn gg-btn--plus hoverizzato" href="{{ path('adminUrbinoEventsDetail') }}">+ Nuovo evento</a>
    </div>

    <table id="main-table">
        <thead>
        <tr>
            <th>Titolo</th>
            <th>Categoria</th>
            <th>Edizione</th>
            <th>Data e ora</th>
            <th>Visibilità</th>
            <th>Creato</th>
            <th></th>
        </tr>
        </thead>
    </table>

{% endblock %}

{% block js %}

    <script type="module">
        import DataTable from 'datatables.net-dt';
        import 'datatables.net-dt/css/dataTables.dataTables.min.css';

        const table = new DataTable("#main-table", {
            serverSide: true,
            ajax: {
                url: "{{ path('adminUrbinoEventsListJson') }}",
            },
            order: [[3, 'desc']],
            columns: [
                { data: "title" },
                { data: "category" },
                { data: "editionName" },
                { data: "eventDatetime" },
                { data: "isPublic", orderable: false },
                { data: "createdAt", orderable: false },
                { data: "eventDetailLink", orderable: false },
            ],
            columnDefs: [
                {
                    targets: '_all', orderSequence: ['desc', 'asc', '']
                },
                {
                    targets: 1, render: function(data, type, row) {
                        const map = {
                            'event_type_festival': { label: 'Festival',  cls: 'festival' },
                            'event_type_mostra':   { label: 'Mostra',    cls: 'mostra'   },
                            'event_type_convegni': { label: 'Convegni',  cls: 'convegni' },
                        };
                        const entry = map[data];
                        return entry
                            ? "<span class='chip chip--" + entry.cls + "'>" + entry.label + "</span>"
                            : "<span class='chip chip--neutral'>" + (data ?? '—') + "</span>";
                    }
                },
                {
                    targets: 4, render: function(data, type, row) {
                        return data ? "<span class='chip chip--visible'>Pubblico</span>" : "<span class='chip chip--deleted'>Nascosto</span>";
                    }
                },
                {
                    targets: 6, render: function(data, type, row) {
                        return "<a href='"+data+"' class='gg-table-btn'>Modifica evento</a>";
                    }
                }
            ],
            pageLength: 25,
            language: {
                search: "Cerca:",
                lengthMenu: "Mostra _MENU_ risultati per pagina",
                info: "Mostrati da _START_ a _END_ di _TOTAL_ risultati",
                infoEmpty: "Nessun risultato disponibile",
                infoFiltered: "(filtrati da _MAX_ risultati totali)",
                paginate: {
                    first: "Primo",
                    last: "Ultimo",
                    next: "Successivo",
                    previous: "Precedente"
                },
                emptyTable: "Nessun dato disponibile nella tabella",
                zeroRecords: "Nessun risultato trovato"
            }
        });

    </script>

{% endblock %}
